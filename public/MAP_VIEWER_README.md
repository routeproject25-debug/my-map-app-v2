# üß≠ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä (Map Viewer)

## –û–ø–∏—Å
–°–ø—Ä–æ—â–µ–Ω–∞ –º–æ–±—ñ–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è –∫–∞—Ä—Ç–∏ –¥–ª—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó –≤ –ø–æ–ª—ñ. –ü–æ–∫–∞–∑—É—î –≥–µ–æ–∑–æ–Ω–∏, –¥–æ–∑–≤–æ–ª—è—î —à—É–∫–∞—Ç–∏ –ø–æ–ª—è —Ç–∞ –Ω–∞—Å–µ–ª–µ–Ω—ñ –ø—É–Ω–∫—Ç–∏, –≤—ñ–¥—Å—Ç–µ–∂—É—î GPS-–ª–æ–∫–∞—Ü—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

## –î–æ—Å—Ç—É–ø
–°—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∑–∞ –∞–¥—Ä–µ—Å–æ—é `/map-viewer.html`

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å `/admin.html`
2. –ó–Ω–∞–π–¥—ñ—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
3. –£–≤—ñ–º–∫–Ω—ñ—Ç—å —á–µ–∫–±–æ–∫—Å **üß≠ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä**
4. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–±–∞—á–∏—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è "üß≠ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä" —É —Ç–æ–ø–±–∞—Ä—ñ

**–ü—Ä–∏–º—ñ—Ç–∫–∞**: –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (—á–µ—Ä–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Ä–æ–ª—ñ –≤ auth-guard).

### Firestore –ø–æ–ª–µ
```
users/{uid}
  allowMapViewer: true/false
```

## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª

### ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
- üîê –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø—É —á–µ—Ä–µ–∑ `allowMapViewer` –ø–æ–ª–µ
- üß≠ GPS-–≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑ –ø—É–ª—å—Å—É—é—á–∏–º –º–∞—Ä–∫–µ—Ä–æ–º
- üó∫ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥–µ–æ–∑–æ–Ω (—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —Ö–∞–±–∞–º–∏ —è–∫ –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π)
- üîç –ü–æ—à—É–∫ –ø–æ–ª—ñ–≤ (–≥–µ–æ–∑–æ–Ω) —Ç–∞ –Ω–∞—Å–µ–ª–µ–Ω–∏—Ö –ø—É–Ω–∫—Ç—ñ–≤
- üì± –ú–æ–±—ñ–ª—å–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è (–≤–µ–ª–∏–∫—ñ –∫–Ω–æ–ø–∫–∏ 56px)
- üëÜ Touch-friendly —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚ö° –ü–ª–∞–≤–Ω—ñ –∞–Ω—ñ–º–∞—Ü—ñ—ó —Ç–∞ –≥—Ä–∞–¥—ñ—î–Ω—Ç–∏

### üéØ –û—Å–Ω–æ–≤–Ω—ñ –∫–Ω–æ–ø–∫–∏
- **üß≠ –ú–æ—î –º—ñ—Å—Ü–µ** - —É–≤—ñ–º–∫–Ω—É—Ç–∏/–≤–∏–º–∫–Ω—É—Ç–∏ GPS-—Ç—Ä–µ–∫—ñ–Ω–≥
- **üó∫ –ì–µ–æ–∑–æ–Ω–∏** - –ø–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –ø–æ–ª—è

### üîç –ü–æ—à—É–∫
–ü—Ä–∞—Ü—é—î —è–∫ –¥–ª—è –≥–µ–æ–∑–æ–Ω (üó∫), —Ç–∞–∫ —ñ –¥–ª—è –º—ñ—Å—Ç/—Å–µ–ª (üìç) —á–µ—Ä–µ–∑ Mapbox Geocoding API.

## –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### Auth Guard
```javascript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
const userData = await db.collection('users').doc(uid).get();
if (userData.allowMapViewer !== true) {
  alert('–£ –≤–∞—Å –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É...');
  // –†–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥—ñ–Ω
}
```

### –ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è
```javascript
navigator.geolocation.watchPosition(
  (pos) => {
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞ —Ç–∞ —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∏
  },
  (error) => { ... },
  { enableHighAccuracy: true, maximumAge: 5000, timeout: 10000 }
);
```

### –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –≥–µ–æ–∑–æ–Ω
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç—É —Å–∞–º—É –ª–æ–≥—ñ–∫—É —â–æ –π –≥–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞:
- Admin/Security - –≤—Å—ñ –≥–µ–æ–∑–æ–Ω–∏
- –Ü–Ω—à—ñ —Ä–æ–ª—ñ - –ª–∏—à–µ –≥–µ–æ–∑–æ–Ω–∏ –∑ –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö —Ö–∞–±—ñ–≤

## –í—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏

### ‚ùå –ü—Ä–∏–±—Ä–∞–Ω–æ
- –ü–∞–Ω–µ–ª—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤
- –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è (–ª—ñ–Ω—ñ–π–∫–∞)
- –ü—Ä–æ–º—ñ–∂–Ω—ñ —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç—É
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è/–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤
- –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–≥–æ–¥–∂–µ–Ω–Ω—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å
- –ï–∫—Å–ø–æ—Ä—Ç/—ñ–º–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö

### ‚ûï –î–æ–¥–∞–Ω–æ
- –°–ø—Ä–æ—â–µ–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö
- GPS-—Ç—Ä–µ–∫—ñ–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- –í–µ–ª–∏–∫—ñ touch-–∫–Ω–æ–ø–∫–∏
- –ü–ª–∞–≤–∞—é—á–∞ –ø–∞–Ω–µ–ª—å –∑–Ω–∏–∑—É

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

1. –£–≤—ñ–π–¥—ñ—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –∑ –∞–∫–∞—É–Ω—Ç–æ–º, —â–æ –º–∞—î `allowMapViewer: true`
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **üß≠ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä** —É –º–µ–Ω—é
3. –î–æ–∑–≤–æ–ª—å—Ç–µ –±—Ä–∞—É–∑–µ—Ä—É –¥–æ—Å—Ç—É–ø –¥–æ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó
4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **üß≠ –ú–æ—î –º—ñ—Å—Ü–µ** –¥–ª—è –ø–æ—á–∞—Ç–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è
5. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–æ—à—É–∫ –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ –∞–±–æ –º—ñ—Å—Ç

## –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –±—Ä–∞—É–∑–µ—Ä—ñ–≤
- ‚úÖ Chrome/Edge (Android/iOS)
- ‚úÖ Safari (iOS)
- ‚úÖ Firefox (Android)
- ‚ö†Ô∏è –ü–æ—Ç—Ä—ñ–±–µ–Ω HTTPS –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó (–∫—Ä—ñ–º localhost)

## –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è
- [ ] –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤—ñ–¥—Å—Ç–∞–Ω—ñ –¥–æ –≤–∏–±—Ä–∞–Ω–æ–≥–æ –ø–æ–ª—è
- [ ] –Ü—Å—Ç–æ—Ä—ñ—è –≤—ñ–¥–≤—ñ–¥–∞–Ω–∏—Ö –º—ñ—Å—Ü—å
- [ ] –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º (Service Worker)
- [ ] –ö–æ–º–ø–∞—Å (–æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—è –ø—Ä–∏—Å—Ç—Ä–æ—é)
- [ ] –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è –¥–æ –æ–±—Ä–∞–Ω–æ–≥–æ –ø–æ–ª—è
