# Перегляд маршрутів на сторінці «Експорт»

Цей режим дозволяє швидко переглядати маршрут для обраного рядка прямо на карті, не заважаючи роботі з таблицею.

## Як увімкнути карту

- Натисніть кнопку «Показати карту» внизу сторінки.
- Карта завантажується ліниво (тільки після натискання) та зʼявляється внизу, зміщуючи таблицю вгору.

## Взаємодія

- Клік по рядку таблиці вмикає відображення маршруту на карті.
- Відображаються:
  - «Притягнута до доріг» лінія маршруту (Mapbox Directions API).
  - Початкова та кінцева точки.
  - Геозони «Від/До» (якщо вказані в записі або знайдені у підключених тайлсетах).
- Після перемикання стилю карти власні шари автоматично додаються знову.

## Кольори

- Лінія маршруту (snapped): червона `#ef4444`.
- «Лінійки» (якщо є у записі маршруту):
  - старт — синій `#0066ff`;
  - кінець — помаранчевий `#f59e0b`.
- Кола точок:
  - старт — зелений `#22c55e`;
  - кінець — червоний `#ef4444`.

## Геозони (тайлсети)

- Підключаються з файлу `public/config/tilesets.json` (векторні джерела).
- Зони «Від/До» підсвічуються фільтрами за можливими полями (Name/Code та ін.) — потрібні збіги з назвою/кодом, що є у маршруті.

## Перемикач стилю та підписи

- У нижньому лівому куті доступний перемикач стилів карти (streets/satellite/outdoors).
- Підписи на карті перемикаються на українську (name_uk, з запасними полями як fallback).

## Розмір панелі карти

- Висоту панелі можна змінювати перетягуванням за «ручку» над картою.
- Поточна висота запамʼятовується в `localStorage` за ключем `export.mapPanelHeight.v1`.

## Притягування до доріг (snapping)

- Використовується Mapbox Directions API (режим driving, geometries=geojson, overview=full).
- Обмеження: максимум 25 точок маршруту на один запит.
- Якщо Directions недоступний або не повернув результат, відображається оригінальна лінія з ваших точок.

## Налаштування

- Токен Mapbox береться з `APP_CONFIG.mapboxToken` (глобальний конфіг сторінки).
- Джерела геозон — у `public/config/tilesets.json`.

## Поради з усунення проблем

- «Карта не зʼявляється» — переконайтесь, що натиснули «Показати карту» і немає помилок у консолі.
- «Маршрут не червоний/шари зникли після зміни стилю» — оновіть сторінку (Ctrl+F5). Шари додаються після `style.load` автоматично.
- «Snapping не працює» — перевірте валідність `APP_CONFIG.mapboxToken` або тимчасові обмеження Directions API.
- «Зони не підсвічуються» — перевірте вміст `tilesets.json` та наявність відповідних атрибутів (Name/Code тощо) у даних геозони.
